## mblog_comment_scheme
### 功能
#### 转评赞
* 每条微博均可被转发，评论(100字内)，点赞
* 对转评赞进行计数并存储

#### 存储内容
* 某人某时对某人的某条微博进行了某些评论
* 某人某时对某人的某条评论进行了某些评论或点赞

#### 查询方式
* 批量分页获取某条微博的所有评论（支持按热度和时间排序）
* 批量分页获取某条评论的所有评论
* 批量获取某条微博的某批评论某人是否点赞

---

### 方案设计
#### 微博发布量级预估
* 日均原创发博数:1000000*5 + 10000000*0.1 + 100000000*0.01 = 700-0000/day
* 日均评论数:700-0000*10/day = 7000-0000/day
* 日均点赞数:700-0000*100/day = 7-0000-0000/day
* 日均转发数:700-0000*1/day = 7-0000-0000/day

---

#### 存储设计
##### 存储介质
* 评论量总体很大，主体采用hbase进行存储
* 热点数据排序，维护一份redis（缓存）并且由mysql落地存储，数据量较小
    - 每次互动进行计数，以互动次数为score进行排序

##### 存储形式
###### 微博评论元信息(mblog_comment_[mid])
* 单张table存储单条微博的所有评论信息(不包括子评论信息)
* row_key设计
    - 评论时间戳反转(int64.Max_Value-cur_timestamp)
    - 方便进行按时间戳从新到旧排序分页获取
    - 前缀取mid的hash值的前4位,方便在微博维度对评论信息进行hash，降低可能存在的单点region-server热点写压力
    - 或者前缀取当前时间戳的分钟数,小时数（24个分区或者60个分区）
###### 微博评论按热点排序
* 最热评论数据从redis或者mysql中取
* 剩余数据从hbase中取（中间需要做一次去重）

